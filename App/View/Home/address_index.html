<%=include indexheader_index.html%>
<style>
    .formdiv{background: #fff;padding: 15px;}
</style>
<script>
    var addressJSON = <%- JSON.stringify(address[0])%>;
</script>
<form id="form">
<nav class="navbar navbar-default navbar-fixed-bottom">
    <div class="container-fluid">
        <button type="submit" class="btn btn-success navbar-btn btn-block btn-lg" v-on="click:update">确定</button>
    </div>
</nav>
<div class="formdiv">
        <div class="form-group">
            <label for="receiveUser">联系人</label>
            <input type="text" class="form-control input-lg" id="receiveUser" placeholder="你的姓名" v-model="receiveuser | name">
        </div>
        <div class="form-group">
            <label for="phoneNum">联系电话</label>
            <input type="tel" class="form-control input-lg" id="phoneNum" placeholder="你的手机号" v-model="phonenum | phone" v-on="keyup:check">
        </div>
        <div class="form-group">
            <label for="address">送餐地址</label>
            <input type="address" class="form-control input-lg" id="addressKey" placeholder="小区/写字楼/学校等" data-toggle="modal" data-target="#searchAddress" v-model="addressKey" readonly >
        </div>
        <input type="address" class="form-control input-lg" id="address" placeholder="详细地址（如门牌号等）" v-model="address | name">
</div>
</form>
<div class="modal fade" id="searchAddress" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <input type="text" class="form-control input-lg" id="exampleInputAmount" placeholder="小区/写字楼/学校等">
            </div>
            <div class="modal-body">

            </div>
        </div>
    </div>
</div>

<script>
    var form = new Vue({
        el: '#form',
        data: addressJSON,
        methods:{
            update:function(e){
                e.preventDefault();
                var updateJson = this.$data;
                var updateId = updateJson.id;
                $.ajax({
                    type:'POST',
                    url:'/address/update',
                    data:{updateJson:JSON.stringify(updateJson),id:updateId},
                    success:function(data){
                        console.log(data);
                    }
                })
            },
            checkphone:function(e){
                var re = /^1\d{10}$/;
                if (re.test(this.$data.phonenum)) {
                    e.target.parentNode.className="form-group has-success";
                } else {
                    e.target.parentNode.className="form-group has-error";
                }
            }
        },
        filters: {
            name: function(value){
                var pattern = new RegExp("[`~!@#$^&*()=|{}':;',\\[\\].<>/?~！@#￥……&*（）&mdash;—|{}【】‘；：”“'。，、？]");
                return value.replace(pattern, '');
            },
            phone:function(value){
                var pattern = new RegExp("/\D/g");
                return value.replace(pattern, '');
            }
        }
    });
</script>
</body>
</html>